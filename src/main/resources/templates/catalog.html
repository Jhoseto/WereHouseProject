<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="bg"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Съни Комерс-Каталог Клиенти</title>
    <meta name="description" content="Каталог с продукти от Съни Комерс-Димо Пенев ООД. Над 2500 артикула за хотели, ресторанти и хорека бизнес.">

    <th:block th:replace="~{fragments/topHtmlImports :: topImports}"></th:block>
    <link rel="stylesheet" href="/css/catalog.css">
</head>
<body>

<!-- Навигация -->
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Toast Container -->
<div id="toastContainer" class="toast-container"></div>

<section class="catalog-section">
    <div class="container">
        <!-- Header -->
        <div class="catalog-header">
            <h1 class="catalog-title">
                <i class="bi bi-archive"></i>
                Каталог продукти
            </h1>
            <div class="catalog-stats">
                <span><span id="product-count">0</span> продукта</span>
                <span id="filtered-count" class="filtered-count hidden"></span>
            </div>
        </div>

        <!-- Search & Filters -->
        <div class="catalog-controls">
            <div class="search-container">
                <div class="search-box">
                    <input type="text"
                           id="search-input"
                           class="search-input"
                           placeholder="Търси по име или SKU..."
                           autocomplete="off">
                    <button type="button" id="clear-search" class="clear-search hidden">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
            </div>

            <div class="filters-container">
                <div class="filter-group">
                    <label for="category-filter" class="filter-label">Категория</label>
                    <select id="category-filter" class="filter-select">
                        <option value="">Всички категории</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="price-min" class="filter-label">Минимална цена</label>
                    <input type="number" id="price-min" class="filter-input"
                           placeholder="0.00" step="0.01" min="0">
                </div>

                <div class="filter-group">
                    <label for="price-max" class="filter-label">Максимална цена</label>
                    <input type="number" id="price-max" class="filter-input"
                           placeholder="999.99" step="0.01" min="0">
                </div>

                <div class="filter-group">
                    <label for="sort-by" class="filter-label">Сортиране</label>
                    <select id="sort-by" class="filter-select">
                        <option value="name-asc">Име А-Я</option>
                        <option value="name-desc">Име Я-А</option>
                        <option value="price-asc">Цена възходящо</option>
                        <option value="price-desc">Цена низходящо</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="per-page" class="filter-label">Показвай</label>
                    <select id="per-page" class="filter-select">
                        <option value="12">12 на страница</option>
                        <option value="24" selected>24 на страница</option>
                        <option value="48">48 на страница</option>
                        <option value="96">96 на страница</option>
                    </select>
                </div>
            </div>

            <div class="view-controls">
                <button type="button" id="grid-view" class="view-btn active">
                    <i class="bi bi-grid-3x2"></i>
                    Мрежа
                </button>
                <button type="button" id="list-view" class="view-btn">
                    <i class="bi bi-list-task"></i>
                    Списък
                </button>
                <button type="button" id="clear-filters" class="view-btn">
                    <i class="bi bi-arrow-counterclockwise"></i>
                    Изчисти
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="loading-state">
            <div class="loading-spinner"></div>
            <p>Зареждане на продуктите...</p>
        </div>

        <!-- Products Container -->
        <div id="products-container" class="products-container hidden">
            <!-- Products will be populated by JavaScript -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="empty-state hidden">
            <h3>Няма продукти</h3>
            <p id="empty-message">Няма налични продукти в каталога в момента.</p>
            <button type="button" id="reset-search" class="view-btn">
                Опресни
            </button>
        </div>

        <!-- No Results State -->
        <div id="no-results" class="empty-state hidden">
            <h3>Няма резултати</h3>
            <p>Не бяха намерени продукти отговарящи на търсенето.</p>
            <button type="button" class="view-btn" onclick="window.catalogManager.clearAllFilters()">
                Изчисти филтрите
            </button>
        </div>
    </div>
    <!-- Pagination Container - НОВА СЕКЦИЯ -->
    <div id="pagination-container" class="pagination-container"></div>
</section>


<!-- FLOATING CART ICON - САМО ЗА КАТАЛОЖНАТА СТРАНИЦА -->
<div sec:authorize="isAuthenticated()" class="floating-cart-container">
    <span class="floating-cart-badge" id="cart-badge">0</span>
    <div class="floating-cart-icon" onclick="toggleCartPanel()"
         title="Отвори количката">
        <i class="bi bi-cart3"></i>
        <div class="floating-cart-ripple"></div>
    </div>
</div>

<!-- CART PANEL FRAGMENT - Зарежда се само когато е нужно -->
<div sec:authorize="isAuthenticated()" th:replace="~{fragments/cartFragment :: cartPanel}"></div>

<!-- Include Footer Fragment -->
<div th:replace="~{fragments/footer :: footer}"></div>

<!-- Scripts -->
<script src="/js/catalog.js"></script>
<th:block th:replace="~{fragments/bottomHtmlImports :: bottomImports}"></th:block>
</body>
</html>
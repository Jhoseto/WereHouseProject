<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="bg">

<head>
    <title>MainDashboard | Warehouse Portal</title>

    <!-- Standard project imports -->
    <div th:replace="~{fragments/topHtmlImports :: topImports}"></div>

    <!-- Dashboard specific CSS -->
    <link rel="stylesheet" href="/css/mainDashboard.css">
</head>

<body>
<!-- Flash Messages Data -->
<div th:replace="~{fragments/toastSystem :: flashData}"></div>

<!-- Navigation -->
<div th:replace="~{fragments/navbar :: navbar}"></div>
<div th:replace="~{fragments/toastSystem :: toastContainer}"></div>

<!-- Header with integrated quick stats -->
<header class="header">
    <div class="header-top">
        <h1 class="header-title">Операторски панел</h1>
        <div class="header-actions">
            <button class="header-btn" onclick="refreshDashboard()" title="Обнови">
                <i class="bi bi-arrow-clockwise"></i>
            </button>
            <button class="header-btn" onclick="toggleNotifications()" title="Нотификации">
                <i class="bi bi-bell"></i>
            </button>
            <button class="header-btn active" onclick="showSettings()" title="Настройки">
                <i class="bi bi-gear"></i>
            </button>
        </div>
    </div>

    <!-- Compact status overview -->
    <div class="status-bar">
        <div class="status-item urgent" onclick="switchTab('urgent')">
            <div class="status-number" id="urgent-count">0</div>
            <div class="status-text">Спешни поръчки</div>
        </div>
        <div class="status-item warning" onclick="switchTab('pending')">
            <div class="status-number" id="pending-count">0</div>
            <div class="status-text">Чакащи обработка</div>
        </div>
        <div class="status-item info" onclick="switchTab('confirmed')">
            <div class="status-number" id="completed-count">0</div>
            <div class="status-text">Обработени поръчки</div>
        </div>
        <div class="status-item danger" onclick="switchTab('cancelled')">
            <div class="status-number" id="cancelled-count">0</div>
            <div class="status-text">Отказани поръчки</div>
        </div>
    </div>
</header>

<!-- Tab Navigation -->
<nav class="tab-nav">
    <button class="tab-btn" onclick="switchTab('activity')" data-tab="activity">
        <i class="tab-icon bi bi-activity"></i>
        <span>Активност</span>
    </button>
    <button class="tab-btn" onclick="switchTab('manage')" data-tab="manage">
        <i class="tab-icon bi bi-grid"></i>
        <span>Управление</span>
    </button>
</nav>

<!-- Main Content -->
<main class="content">

    <!-- Urgent Orders Tab -->
    <div class="tab-content active" id="urgent-tab">
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">За незабавна обработка</div>
                <div class="panel-badge" id="urgent-badge" th:text="${urgentCount ?: 0}">0</div>
            </div>
            <div class="panel-content">
                <!-- Празен контейнер - JavaScript ще добави реалните поръчки тук -->
                <div id="urgent-orders-container">
                    <!-- Реалните поръчки ще се заредят тук от JavaScript модулите -->
                </div>
            </div>
        </div>
    </div>

    <!-- Pending Orders Tab -->
    <div class="tab-content" id="pending-tab">
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">В процес на обработка</div>
                <div class="panel-badge" id="pending-badge" th:text="${confirmedCount ?: 0}">0</div>
            </div>
            <div class="panel-content">
                <!-- Pending orders content -->
            </div>
        </div>
    </div>

    <!-- Confirmed Orders Tab -->
    <div class="tab-content" id="confirmed-tab">
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">Обработени поръчки</div>
                <div class="panel-badge" id="confirmed-badge">0</div>
            </div>
            <div class="panel-content">
                <div id="confirmed-orders-container">
                    <!-- JavaScript ще зареди поръчките тук -->
                </div>
            </div>
        </div>
    </div>

    <div class="tab-content" id="cancelled-tab">
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">Отказани поръчки</div>
                <div class="panel-badge" id="cancelled-badge">0</div>
            </div>
            <div class="panel-content">
                <div id="cancelled-orders-container">
                    <!-- JavaScript ще зареди поръчките тук -->
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Feed Tab -->
    <div class="tab-content" id="activity-tab">
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">Последна активност</div>
            </div>
            <div class="panel-content">
                <!-- Activity content -->
            </div>
        </div>

        <!-- Daily Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" th:text="${dailyStats.processed ?: 0}">0</div>
                <div class="stat-label">Обработени</div>
                <div class="stat-change change-positive">+15%</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" th:text="${dailyStats.revenue ?: '0.0'}">0.0</div>
                <div class="stat-label">Продажби (лв)</div>
                <div class="stat-change change-positive">+8%</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" th:text="${dailyStats.avgTime ?: '0.0ч'}">0.0ч</div>
                <div class="stat-label">Среден срок</div>
                <div class="stat-change change-negative">-12%</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" th:text="${dailyStats.activeClients ?: 0}">0</div>
                <div class="stat-label">Активни клиенти</div>
                <div class="stat-change change-positive">+3</div>
            </div>
        </div>
    </div>

    <!-- Management Tab -->
    <div class="tab-content" id="manage-tab">
        <div class="nav-grid">
            <a href="/admin/orders" class="nav-item">
                <i class="nav-icon bi bi-list-ul"></i>
                <span class="nav-label">Всички поръчки</span>
            </a>

            <a href="/admin/catalog" class="nav-item">
                <i class="nav-icon bi bi-box-seam"></i>
                <span class="nav-label">Каталог</span>
            </a>

            <a href="/admin/clients" class="nav-item">
                <i class="nav-icon bi bi-people"></i>
                <span class="nav-label">Клиенти</span>
            </a>

            <a href="/admin/reports" class="nav-item">
                <i class="nav-icon bi bi-graph-up"></i>
                <span class="nav-label">Отчети</span>
            </a>

            <a href="/admin/inventory" class="nav-item">
                <i class="nav-icon bi bi-boxes"></i>
                <span class="nav-label">Инвентар</span>
            </a>

            <a href="/admin/settings" class="nav-item">
                <i class="nav-icon bi bi-gear"></i>
                <span class="nav-label">Настройки</span>
            </a>
        </div>
    </div>

</main>

<!-- Rejection Modal -->
<div class="modal-overlay" id="rejection-modal">
    <div class="modal">
        <div class="modal-header">Причина за отказ</div>

        <div class="reason-options">
            <div class="reason-option" onclick="selectReason(this, 'Няма в наличност')">
                <strong>Няма в наличност</strong><br>
                <small>Продуктът не е наличен в склада</small>
            </div>
            <div class="reason-option" onclick="selectReason(this, 'Невъзможна доставка в срок')">
                <strong>Невъзможна доставка в срок</strong><br>
                <small>Не можем да доставим в исканото време</small>
            </div>
            <div class="reason-option" onclick="selectReason(this, 'Изтекъл срок на годност')">
                <strong>Изтекъл срок на годност</strong><br>
                <small>Продуктът е с изтекъл срок</small>
            </div>
            <div class="reason-option" onclick="selectReason(this, 'Повреден продукт')">
                <strong>Повреден продукт</strong><br>
                <small>Продуктът е с дефект или повреда</small>
            </div>
            <div class="reason-option" onclick="selectReason(this, 'Заменен с алтернатива')">
                <strong>Заменен с алтернатива</strong><br>
                <small>Предлагаме алтернативен продукт</small>
            </div>
        </div>

        <textarea class="custom-reason" id="custom-reason" placeholder="Или напишете персонализирана причина..."></textarea>

        <div class="modal-actions">
            <button class="modal-btn btn-cancel" onclick="closeRejectionModal()">Отказ</button>
            <button class="modal-btn btn-confirm" onclick="confirmRejection()">Потвърди отказа</button>
        </div>
    </div>
</div>

<!-- Include Footer Fragment -->
<div th:replace="~{fragments/footer :: footer}"></div>
<script th:inline="javascript">
    window.dashboardConfig = {
        userId: /*[[${userId}]]*/'',
        csrfToken: /*[[${csrfToken}]]*/ '',
        csrfHeader: /*[[${csrfHeader}]]*/ '',
        initialDashboardData: /*[[${initialDashboardData}]]*/ {}
    };
</script>


<!-- Dashboard JavaScript -->
<script src="/js/dashboard/dashboardApi.js"></script>
<script src="/js/dashboard/dashboardManager.js"></script>
<script src="/js/dashboard/dashboardUI.js"></script>
<script src="/js/dashboard/mainDashboard.js"></script>

<!-- Standard project bottom imports -->
<div th:replace="~{fragments/bottomHtmlImports :: bottomImports}"></div>

</body>
</html>
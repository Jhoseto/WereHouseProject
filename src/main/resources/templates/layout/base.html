<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="bg" th:fragment="content">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title th:text="#{app.title} + ' - ' + ${pageTitle ?: '–ù–∞—á–∞–ª–æ'}">–°–∫–ª–∞–¥–æ–≤ –ø–æ—Ä—Ç–∞–ª</title>
        <link rel="stylesheet" th:href="@{/css/main.css}" />
        <link rel="stylesheet" th:href="@{/css/components.css}" />
        <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
        <meta name="description" content="–°–∫–ª–∞–¥–æ–≤ –ø–æ—Ä—Ç–∞–ª –∑–∞ B2B –∑–∞—è–≤–∫–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏">
    </head>
    <body>
        <header class="site-header">
            <div class="header-content">
                <div class="logo">
                    <a th:href="@{/}" class="logo-link">
                        <span class="logo-text" th:text="#{app.title}">–°–∫–ª–∞–¥–æ–≤ –ø–æ—Ä—Ç–∞–ª</span>
                    </a>
                </div>

                <nav class="nav" sec:authorize="isAuthenticated()">
                    <a th:href="@{/}" class="nav-link" th:classappend="${#request.requestURI == '/' ? 'active' : ''}">
                        <span class="nav-icon">üè†</span> –ù–∞—á–∞–ª–æ
                    </a>
                    <a th:href="@{/catalog}" class="nav-link" th:classappend="${#strings.startsWith(#request.requestURI, '/catalog') ? 'active' : ''}">
                        <span class="nav-icon">üì¶</span> –ö–∞—Ç–∞–ª–æ–≥
                    </a>
                    <a th:href="@{/cart}" class="nav-link" sec:authorize="hasRole('CLIENT')" th:classappend="${#strings.startsWith(#request.requestURI, '/cart') ? 'active' : ''}">
                        <span class="nav-icon">üõí</span> –ö–æ—à–Ω–∏—Ü–∞
                        <span th:if="${session.CART != null and not #maps.isEmpty(session.CART)}" class="cart-count" th:text="${#maps.size(session.CART)}">0</span>
                    </a>
                    <a th:href="@{/orders}" class="nav-link" sec:authorize="hasRole('CLIENT')" th:classappend="${#strings.startsWith(#request.requestURI, '/orders') ? 'active' : ''}">
                        <span class="nav-icon">üìã</span> –ú–æ–∏—Ç–µ –∑–∞—è–≤–∫–∏
                    </a>
                    <a th:href="@{/admin}" class="nav-link" sec:authorize="hasRole('ADMIN')" th:classappend="${#strings.startsWith(#request.requestURI, '/admin') ? 'active' : ''}">
                        <span class="nav-icon">‚öôÔ∏è</span> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª
                    </a>
                </nav>

                <div class="auth">
                    <div sec:authorize="isAuthenticated()" class="user-info">
                        <span class="welcome-text">–ó–¥—Ä–∞–≤–µ–π—Ç–µ, </span>
                        <span class="username" th:text="${#authentication.name}">user</span>
                        <span class="user-role" sec:authorize="hasRole('ADMIN')" title="–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä">üëë</span>
                        <span class="user-role" sec:authorize="hasRole('CLIENT')" title="–ö–ª–∏–µ–Ω—Ç">üë§</span>
                    </div>
                    <a th:if="${#authorization.expression('isAuthenticated()')}" th:href="@{/logout}" class="logout-link" title="–ò–∑—Ö–æ–¥ –æ—Ç —Å–∏—Å—Ç–µ–º–∞—Ç–∞">
                        <span class="nav-icon">üö™</span> –ò–∑—Ö–æ–¥
                    </a>
                    <a th:if="${#authorization.expression('!isAuthenticated()')}" th:href="@{/login}" class="login-link">
                        <span class="nav-icon">üîë</span> –í—Ö–æ–¥
                    </a>
                </div>
            </div>
        </header>

        <main class="container">
            <!-- Flash messages -->
            <div class="flash-messages">
                <div th:if="${success}" class="alert alert-success">
                    <span class="alert-icon">‚úÖ</span>
                    <span th:text="${success}">Success message</span>
                    <button class="alert-close" onclick="this.parentElement.style.display='none'">√ó</button>
                </div>
                <div th:if="${error}" class="alert alert-error">
                    <span class="alert-icon">‚ùå</span>
                    <span th:text="${error}">Error message</span>
                    <button class="alert-close" onclick="this.parentElement.style.display='none'">√ó</button>
                </div>
                <div th:if="${warning}" class="alert alert-warning">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <span th:text="${warning}">Warning message</span>
                    <button class="alert-close" onclick="this.parentElement.style.display='none'">√ó</button>
                </div>
                <div th:if="${info}" class="alert alert-info">
                    <span class="alert-icon">‚ÑπÔ∏è</span>
                    <span th:text="${info}">Info message</span>
                    <button class="alert-close" onclick="this.parentElement.style.display='none'">√ó</button>
                </div>
            </div>

            <div th:insert="~{::content}"></div>
        </main>

        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-left">
                    <small>&copy; 2025 Warehouse Portal</small>
                </div>
                <div class="footer-center">
                    <span sec:authorize="isAuthenticated()" class="session-info">
                        –°–µ—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞: <span th:text="${#dates.format(#dates.createNow(), 'HH:mm')}">–≤—Ä–µ–º—è</span>
                    </span>
                </div>
                <div class="footer-right">
                    <a th:href="@{/about}" class="footer-link">–ó–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞</a>
                </div>
            </div>
        </footer>

        <!-- Scripts -->
        <script th:src="@{/js/common.js}"></script>
        <script>
            // Auto-hide flash messages after 5 seconds
            setTimeout(function() {
                const alerts = document.querySelectorAll('.alert');
                alerts.forEach(alert => {
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 300);
                });
            }, 5000);
        </script>
    </body>
</html>